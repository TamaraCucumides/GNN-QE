/mnt/ialabnas/homes/tacucumides
scylla
Wed Aug 30 00:17:39 -04 2023
Start training
/mnt/ialabnas/homes/tacucumides
00:17:43   Config file: config/fb15k237.yaml
00:17:43   {'dataset': {'class': 'FB15k237LogicalQuery', 'path': '~/kg-datasets/'},
 'engine': {'batch_size': 48, 'gpus': [0]},
 'metric': 'mrr',
 'optimizer': {'class': 'Adam', 'lr': 0.005},
 'output_dir': '~/scratch/experiments/',
 'task': {'adversarial_temperature': 0.2,
          'class': 'LogicalQuery',
          'criterion': 'bce',
          'model': {'class': 'GNN-QE',
                    'dropout_ratio': 0.25,
                    'logic': 'product',
                    'model': {'aggregate_func': 'pna',
                              'class': 'NBFNet',
                              'dependent': True,
                              'hidden_dims': [32, 32, 32, 32],
                              'input_dim': 32,
                              'layer_norm': True,
                              'message_func': 'distmult',
                              'short_cut': True}},
          'sample_weight': False},
 'train': {'batch_per_epoch': 1000, 'num_epoch': 10}}
Loading /home/tacucumides/kg-datasets/FB15k-237-betae/train.txt:   0%|          | 0/544230 [00:00<?, ?it/s]Loading /home/tacucumides/kg-datasets/FB15k-237-betae/train.txt:  16%|█▌        | 84747/544230 [00:00<00:00, 847341.51it/s]Loading /home/tacucumides/kg-datasets/FB15k-237-betae/train.txt:  32%|███▏      | 175209/544230 [00:00<00:00, 881023.25it/s]Loading /home/tacucumides/kg-datasets/FB15k-237-betae/train.txt:  49%|████▉     | 266306/544230 [00:00<00:00, 894687.67it/s]Loading /home/tacucumides/kg-datasets/FB15k-237-betae/train.txt:  66%|██████▌   | 357300/544230 [00:00<00:00, 900701.65it/s]Loading /home/tacucumides/kg-datasets/FB15k-237-betae/train.txt:  82%|████████▏ | 448446/544230 [00:00<00:00, 904573.63it/s]Loading /home/tacucumides/kg-datasets/FB15k-237-betae/train.txt:  99%|█████████▉| 538997/544230 [00:00<00:00, 904874.68it/s]Loading /home/tacucumides/kg-datasets/FB15k-237-betae/train.txt: 100%|██████████| 544230/544230 [00:00<00:00, 898012.50it/s]
Loading /home/tacucumides/kg-datasets/FB15k-237-betae/valid.txt:   0%|          | 0/35052 [00:00<?, ?it/s]Loading /home/tacucumides/kg-datasets/FB15k-237-betae/valid.txt: 100%|██████████| 35052/35052 [00:00<00:00, 847834.51it/s]
Loading /home/tacucumides/kg-datasets/FB15k-237-betae/test.txt:   0%|          | 0/40876 [00:00<?, ?it/s]Loading /home/tacucumides/kg-datasets/FB15k-237-betae/test.txt: 100%|██████████| 40876/40876 [00:00<00:00, 850470.61it/s]
Loading train-*.pkl:   0%|          | 0/3 [00:00<?, ?it/s]Loading train-*.pkl:  33%|███▎      | 1/3 [00:00<00:01,  1.91it/s]Loading train-*.pkl: 100%|██████████| 3/3 [00:19<00:00,  7.18s/it]
Processing train queries:   0%|          | 0/823285 [00:00<?, ?it/s][ALoading train-*.pkl: 100%|██████████| 3/3 [00:19<00:00,  6.52s/it]

Processing train queries:   0%|          | 1/823285 [00:00<28:45:16,  7.95it/s][A
Processing train queries:   1%|          | 4831/823285 [00:00<00:31, 25691.68it/s][A
Processing train queries:   1%|          | 10005/823285 [00:00<00:22, 36935.12it/s][A
Processing train queries:   2%|▏         | 15250/823285 [00:00<00:18, 42851.70it/s][A
Processing train queries:   2%|▏         | 20508/823285 [00:00<00:17, 46282.36it/s][A
Processing train queries:   3%|▎         | 25646/823285 [00:00<00:16, 47987.29it/s][A
Processing train queries:   4%|▍         | 30924/823285 [00:00<00:15, 49537.49it/s][A
Processing train queries:   4%|▍         | 36289/823285 [00:00<00:15, 50836.10it/s][A
Processing train queries:   5%|▌         | 41646/823285 [00:00<00:15, 51685.69it/s][A
Processing train queries:   6%|▌         | 46920/823285 [00:01<00:14, 52009.22it/s][A
Processing train queries:   6%|▋         | 52271/823285 [00:01<00:14, 52467.16it/s][A
Processing train queries:   7%|▋         | 57606/823285 [00:01<00:14, 52732.91it/s][A
Processing train queries:   8%|▊         | 62974/823285 [00:01<00:14, 53016.79it/s][A
Processing train queries:   8%|▊         | 68367/823285 [00:01<00:14, 53292.14it/s][A
Processing train queries:   9%|▉         | 73761/823285 [00:01<00:14, 53487.25it/s][A
Processing train queries:  10%|▉         | 79113/823285 [00:01<00:13, 53455.74it/s][A
Processing train queries:  10%|█         | 84504/823285 [00:01<00:13, 53589.67it/s][A
Processing train queries:  11%|█         | 89865/823285 [00:01<00:13, 53087.52it/s][A
Processing train queries:  12%|█▏        | 95338/823285 [00:01<00:13, 53577.20it/s][A
Processing train queries:  12%|█▏        | 100814/823285 [00:02<00:13, 53927.81it/s][A
Processing train queries:  13%|█▎        | 106277/823285 [00:02<00:13, 54134.88it/s][A
Processing train queries:  14%|█▎        | 111753/823285 [00:02<00:13, 54319.29it/s][A
Processing train queries:  14%|█▍        | 117186/823285 [00:02<00:13, 54162.79it/s][A
Processing train queries:  15%|█▍        | 122662/823285 [00:02<00:12, 54340.37it/s][A
Processing train queries:  16%|█▌        | 128097/823285 [00:02<00:12, 54339.19it/s][A
Processing train queries:  16%|█▌        | 133621/823285 [00:02<00:12, 54606.99it/s][A
Processing train queries:  17%|█▋        | 139082/823285 [00:02<00:12, 54565.57it/s][A
Processing train queries:  18%|█▊        | 144539/823285 [00:02<00:12, 54168.00it/s][A
Processing train queries:  18%|█▊        | 149957/823285 [00:03<00:17, 39084.08it/s][A
Processing train queries:  19%|█▉        | 155015/823285 [00:03<00:15, 41785.66it/s][A
Processing train queries:  19%|█▉        | 160321/823285 [00:03<00:14, 44619.99it/s][A
Processing train queries:  20%|██        | 165625/823285 [00:03<00:14, 46844.01it/s][A
Processing train queries:  21%|██        | 170943/823285 [00:03<00:13, 48580.25it/s][A
Processing train queries:  21%|██▏       | 176034/823285 [00:03<00:13, 48694.63it/s][A
Processing train queries:  22%|██▏       | 181383/823285 [00:03<00:12, 50057.33it/s][A
Processing train queries:  23%|██▎       | 186567/823285 [00:03<00:12, 50570.77it/s][A
Processing train queries:  23%|██▎       | 191920/823285 [00:03<00:12, 51433.26it/s][A
Processing train queries:  24%|██▍       | 197210/823285 [00:03<00:12, 51862.37it/s][A
Processing train queries:  25%|██▍       | 202622/823285 [00:04<00:11, 52523.98it/s][A
Processing train queries:  25%|██▌       | 207941/823285 [00:04<00:11, 52721.09it/s][A
Processing train queries:  26%|██▌       | 213242/823285 [00:04<00:11, 52807.14it/s][A
Processing train queries:  27%|██▋       | 218561/823285 [00:04<00:11, 52918.59it/s][A
Processing train queries:  27%|██▋       | 223878/823285 [00:04<00:11, 52991.74it/s][A
Processing train queries:  28%|██▊       | 229186/823285 [00:04<00:11, 52739.89it/s][A
Processing train queries:  28%|██▊       | 234522/823285 [00:04<00:11, 52923.60it/s][A
Processing train queries:  29%|██▉       | 239819/823285 [00:04<00:11, 52897.60it/s][A
Processing train queries:  30%|██▉       | 245174/823285 [00:04<00:10, 53090.26it/s][A
Processing train queries:  30%|███       | 250497/823285 [00:04<00:10, 53131.23it/s][A
Processing train queries:  31%|███       | 255829/823285 [00:05<00:10, 53187.41it/s][A
Processing train queries:  32%|███▏      | 261149/823285 [00:05<00:10, 53100.71it/s][A
Processing train queries:  32%|███▏      | 266499/823285 [00:05<00:10, 53216.44it/s][A
Processing train queries:  33%|███▎      | 271822/823285 [00:05<00:10, 53010.27it/s][A
Processing train queries:  34%|███▎      | 277124/823285 [00:05<00:10, 52897.22it/s][A
Processing train queries:  34%|███▍      | 282432/823285 [00:05<00:10, 52944.18it/s][A
Processing train queries:  35%|███▍      | 287736/823285 [00:05<00:10, 52971.38it/s][A
Processing train queries:  36%|███▌      | 293034/823285 [00:05<00:10, 52803.48it/s][A
Processing train queries:  36%|███▌      | 298341/823285 [00:05<00:09, 52880.63it/s][A
Processing train queries:  37%|███▋      | 303630/823285 [00:06<00:13, 37385.20it/s][A
Processing train queries:  38%|███▊      | 308854/823285 [00:06<00:12, 40830.56it/s][A
Processing train queries:  38%|███▊      | 314014/823285 [00:06<00:11, 43510.01it/s][A
Processing train queries:  39%|███▉      | 319241/823285 [00:06<00:11, 45807.07it/s][A
Processing train queries:  39%|███▉      | 324493/823285 [00:06<00:10, 47635.78it/s][A
Processing train queries:  40%|████      | 329710/823285 [00:06<00:10, 48905.29it/s][A
Processing train queries:  41%|████      | 334907/823285 [00:06<00:09, 49780.76it/s][A
Processing train queries:  41%|████▏     | 340154/823285 [00:06<00:09, 50560.42it/s][A
Processing train queries:  42%|████▏     | 345308/823285 [00:06<00:09, 50787.79it/s][A
Processing train queries:  43%|████▎     | 350456/823285 [00:07<00:09, 48893.46it/s][A
Processing train queries:  43%|████▎     | 355702/823285 [00:07<00:09, 49917.14it/s][A
Processing train queries:  44%|████▍     | 360925/823285 [00:07<00:09, 50589.66it/s][A
Processing train queries:  44%|████▍     | 366158/823285 [00:07<00:08, 51100.20it/s][A
Processing train queries:  45%|████▌     | 371418/823285 [00:07<00:08, 51542.72it/s][A
Processing train queries:  46%|████▌     | 376645/823285 [00:07<00:08, 51756.92it/s][A
Processing train queries:  46%|████▋     | 381864/823285 [00:07<00:08, 51883.20it/s][A
Processing train queries:  47%|████▋     | 387062/823285 [00:07<00:08, 51791.15it/s][A
Processing train queries:  48%|████▊     | 392248/823285 [00:07<00:08, 51739.00it/s][A
Processing train queries:  48%|████▊     | 397427/823285 [00:07<00:08, 51557.17it/s][A
Processing train queries:  49%|████▉     | 402597/823285 [00:08<00:08, 51598.53it/s][A
Processing train queries:  50%|████▉     | 407769/823285 [00:08<00:08, 51633.62it/s][A
Processing train queries:  50%|█████     | 412935/823285 [00:08<00:08, 51029.23it/s][A
Processing train queries:  51%|█████     | 418158/823285 [00:08<00:07, 51383.09it/s][A
Processing train queries:  51%|█████▏    | 423394/823285 [00:08<00:07, 51672.56it/s][A
Processing train queries:  52%|█████▏    | 428564/823285 [00:10<00:52, 7460.21it/s] [A
Processing train queries:  53%|█████▎    | 433688/823285 [00:10<00:38, 9998.38it/s][A
Processing train queries:  53%|█████▎    | 438701/823285 [00:10<00:29, 13067.85it/s][A
Processing train queries:  54%|█████▍    | 443611/823285 [00:10<00:22, 16616.87it/s][A
Processing train queries:  54%|█████▍    | 448510/823285 [00:10<00:18, 20610.14it/s][A
Processing train queries:  55%|█████▌    | 453161/823285 [00:11<00:22, 16765.25it/s][A
Processing train queries:  56%|█████▌    | 457430/823285 [00:11<00:18, 20077.83it/s][A
Processing train queries:  56%|█████▌    | 461758/823285 [00:11<00:15, 23659.14it/s][A
Processing train queries:  57%|█████▋    | 465924/823285 [00:11<00:13, 26911.42it/s][A
Processing train queries:  57%|█████▋    | 470450/823285 [00:11<00:11, 30675.41it/s][A
Processing train queries:  58%|█████▊    | 474990/823285 [00:11<00:10, 34012.39it/s][A
Processing train queries:  58%|█████▊    | 479505/823285 [00:11<00:09, 36735.07it/s][A
Processing train queries:  59%|█████▉    | 484038/823285 [00:12<00:08, 38959.89it/s][A
Processing train queries:  59%|█████▉    | 488491/823285 [00:12<00:08, 40461.74it/s][A
Processing train queries:  60%|█████▉    | 492970/823285 [00:12<00:07, 41664.02it/s][A
Processing train queries:  60%|██████    | 497412/823285 [00:12<00:07, 42447.85it/s][A
Processing train queries:  61%|██████    | 501855/823285 [00:12<00:07, 43019.56it/s][A
Processing train queries:  62%|██████▏   | 506327/823285 [00:12<00:07, 43515.76it/s][A
Processing train queries:  62%|██████▏   | 510786/823285 [00:12<00:07, 43830.03it/s][A
Processing train queries:  63%|██████▎   | 515266/823285 [00:12<00:06, 44115.24it/s][A
Processing train queries:  63%|██████▎   | 519727/823285 [00:12<00:06, 44190.13it/s][A
Processing train queries:  64%|██████▎   | 524181/823285 [00:12<00:06, 43754.47it/s][A
Processing train queries:  64%|██████▍   | 528709/823285 [00:13<00:06, 44204.13it/s][A
Processing train queries:  65%|██████▍   | 533148/823285 [00:13<00:06, 43606.19it/s][A
Processing train queries:  65%|██████▌   | 537523/823285 [00:13<00:06, 42985.58it/s][A
Processing train queries:  66%|██████▌   | 541833/823285 [00:13<00:06, 42518.89it/s][A
Processing train queries:  66%|██████▋   | 546093/823285 [00:13<00:06, 42005.32it/s][A
Processing train queries:  67%|██████▋   | 550300/823285 [00:13<00:06, 41499.43it/s][A
Processing train queries:  67%|██████▋   | 554465/823285 [00:13<00:06, 41541.26it/s][A
Processing train queries:  68%|██████▊   | 558690/823285 [00:13<00:06, 41713.10it/s][A
Processing train queries:  68%|██████▊   | 562944/823285 [00:13<00:06, 41956.79it/s][A
Processing train queries:  69%|██████▉   | 567303/823285 [00:13<00:06, 42441.25it/s][A
Processing train queries:  69%|██████▉   | 571576/823285 [00:14<00:05, 42526.87it/s][A
Processing train queries:  70%|██████▉   | 575831/823285 [00:14<00:05, 42278.33it/s][A
Processing train queries:  70%|███████   | 580061/823285 [00:14<00:05, 42215.27it/s][A
Processing train queries:  71%|███████   | 584312/823285 [00:14<00:05, 42300.72it/s][A
Processing train queries:  71%|███████▏  | 588543/823285 [00:14<00:05, 41198.62it/s][A
Processing train queries:  72%|███████▏  | 593043/823285 [00:14<00:05, 42313.22it/s][A
Processing train queries:  73%|███████▎  | 597566/823285 [00:14<00:05, 43174.13it/s][A
Processing train queries:  73%|███████▎  | 601890/823285 [00:15<00:10, 21692.34it/s][A
Processing train queries:  74%|███████▎  | 606165/823285 [00:15<00:08, 25388.83it/s][A
Processing train queries:  74%|███████▍  | 610493/823285 [00:15<00:07, 28974.65it/s][A
Processing train queries:  75%|███████▍  | 614603/823285 [00:15<00:06, 31674.06it/s][A
Processing train queries:  75%|███████▌  | 618693/823285 [00:15<00:06, 33898.93it/s][A
Processing train queries:  76%|███████▌  | 622821/823285 [00:15<00:05, 35788.96it/s][A
Processing train queries:  76%|███████▌  | 626954/823285 [00:15<00:05, 37273.86it/s][A
Processing train queries:  77%|███████▋  | 631110/823285 [00:15<00:04, 38460.49it/s][A
Processing train queries:  77%|███████▋  | 635259/823285 [00:15<00:04, 39319.12it/s][A
Processing train queries:  78%|███████▊  | 639455/823285 [00:16<00:04, 40080.12it/s][A
Processing train queries:  78%|███████▊  | 643585/823285 [00:16<00:04, 40323.30it/s][A
Processing train queries:  79%|███████▊  | 647704/823285 [00:16<00:04, 40565.90it/s][A
Processing train queries:  79%|███████▉  | 651822/823285 [00:16<00:04, 39567.10it/s][A
Processing train queries:  80%|███████▉  | 655827/823285 [00:16<00:04, 39441.26it/s][A
Processing train queries:  80%|████████  | 659805/823285 [00:16<00:04, 38581.39it/s][A
Processing train queries:  81%|████████  | 664001/823285 [00:16<00:04, 39558.62it/s][A
Processing train queries:  81%|████████  | 668243/823285 [00:16<00:03, 40392.64it/s][A
Processing train queries:  82%|████████▏ | 672513/823285 [00:16<00:03, 41070.52it/s][A
Processing train queries:  82%|████████▏ | 676775/823285 [00:16<00:03, 41529.37it/s][A
Processing train queries:  83%|████████▎ | 681030/823285 [00:17<00:03, 41830.16it/s][A
Processing train queries:  83%|████████▎ | 685321/823285 [00:17<00:03, 42149.19it/s][A
Processing train queries:  84%|████████▍ | 689542/823285 [00:17<00:03, 41948.94it/s][A
Processing train queries:  84%|████████▍ | 693741/823285 [00:17<00:03, 41692.54it/s][A
Processing train queries:  85%|████████▍ | 697914/823285 [00:17<00:03, 41403.20it/s][A
Processing train queries:  85%|████████▌ | 702057/823285 [00:17<00:03, 37908.25it/s][A
Processing train queries:  86%|████████▌ | 706351/823285 [00:17<00:02, 39312.18it/s][A
Processing train queries:  86%|████████▋ | 710634/823285 [00:17<00:02, 40313.59it/s][A
Processing train queries:  87%|████████▋ | 714946/823285 [00:17<00:02, 41125.46it/s][A
Processing train queries:  87%|████████▋ | 719237/823285 [00:17<00:02, 41645.01it/s][A
Processing train queries:  88%|████████▊ | 723565/823285 [00:18<00:02, 42124.98it/s][A
Processing train queries:  88%|████████▊ | 727890/823285 [00:18<00:02, 42457.20it/s][A
Processing train queries:  89%|████████▉ | 732201/823285 [00:18<00:02, 42651.09it/s][A
Processing train queries:  89%|████████▉ | 736486/823285 [00:18<00:02, 42708.56it/s][A
Processing train queries:  90%|████████▉ | 740764/823285 [00:18<00:01, 42595.13it/s][A
Processing train queries:  90%|█████████ | 745028/823285 [00:18<00:01, 41287.14it/s][A
Processing train queries:  91%|█████████ | 749169/823285 [00:18<00:01, 39540.37it/s][A
Processing train queries:  91%|█████████▏| 753144/823285 [00:20<00:12, 5770.92it/s] [A
Processing train queries:  92%|█████████▏| 757582/823285 [00:20<00:08, 7937.04it/s][A
Processing train queries:  93%|█████████▎| 762053/823285 [00:21<00:05, 10665.62it/s][A
Processing train queries:  93%|█████████▎| 765717/823285 [00:21<00:04, 13146.73it/s][A
Processing train queries:  94%|█████████▎| 770045/823285 [00:21<00:03, 16773.19it/s][A
Processing train queries:  94%|█████████▍| 774367/823285 [00:21<00:02, 20653.31it/s][A
Processing train queries:  95%|█████████▍| 778382/823285 [00:21<00:01, 23294.24it/s][A
Processing train queries:  95%|█████████▌| 782406/823285 [00:21<00:01, 26572.59it/s][A
Processing train queries:  96%|█████████▌| 786505/823285 [00:21<00:01, 29693.98it/s][A
Processing train queries:  96%|█████████▌| 790601/823285 [00:21<00:01, 32355.11it/s][A
Processing train queries:  97%|█████████▋| 794591/823285 [00:21<00:00, 33390.50it/s][A
Processing train queries:  97%|█████████▋| 798891/823285 [00:21<00:00, 35888.10it/s][A
Processing train queries:  98%|█████████▊| 803162/823285 [00:22<00:00, 37735.15it/s][A
Processing train queries:  98%|█████████▊| 807433/823285 [00:22<00:00, 39121.44it/s][A
Processing train queries:  99%|█████████▊| 811574/823285 [00:22<00:00, 37834.60it/s][A
Processing train queries:  99%|█████████▉| 815760/823285 [00:22<00:00, 38957.30it/s][A
Processing train queries: 100%|█████████▉| 819947/823285 [00:22<00:00, 39786.77it/s][ALoading valid-*.pkl:   0%|          | 0/3 [00:00<?, ?it/s]Processing train queries: 100%|██████████| 823285/823285 [00:22<00:00, 36482.04it/s]
Loading valid-*.pkl:  67%|██████▋   | 2/3 [00:02<00:01,  1.37s/it]Loading valid-*.pkl: 100%|██████████| 3/3 [00:03<00:00,  1.04s/it]
Processing valid queries:   0%|          | 0/85094 [00:00<?, ?it/s][ALoading valid-*.pkl: 100%|██████████| 3/3 [00:03<00:00,  1.10s/it]

Processing valid queries:   5%|▌         | 4342/85094 [00:00<00:01, 43416.52it/s][A
Processing valid queries:  11%|█         | 9530/85094 [00:00<00:01, 48389.74it/s][A
Processing valid queries:  17%|█▋        | 14369/85094 [00:00<00:01, 47603.71it/s][A
Processing valid queries:  23%|██▎       | 19660/85094 [00:00<00:01, 49674.90it/s][A
Processing valid queries:  29%|██▉       | 24839/85094 [00:00<00:01, 50431.02it/s][A
Processing valid queries:  35%|███▌      | 29996/85094 [00:00<00:01, 50813.85it/s][A
Processing valid queries:  41%|████      | 35080/85094 [00:00<00:01, 48704.13it/s][A
Processing valid queries:  47%|████▋     | 39968/85094 [00:00<00:00, 46479.73it/s][A
Processing valid queries:  52%|█████▏    | 44643/85094 [00:00<00:00, 44841.11it/s][A
Processing valid queries:  58%|█████▊    | 49151/85094 [00:01<00:00, 44336.04it/s][A
Processing valid queries:  63%|██████▎   | 53599/85094 [00:01<00:00, 44136.14it/s][A
Processing valid queries:  68%|██████▊   | 58022/85094 [00:01<00:00, 43395.18it/s][A
Processing valid queries:  73%|███████▎  | 62368/85094 [00:01<00:00, 42523.91it/s][A
Processing valid queries:  78%|███████▊  | 66626/85094 [00:01<00:00, 42318.65it/s][A
Processing valid queries:  83%|████████▎ | 70924/85094 [00:01<00:00, 42509.70it/s][A
Processing valid queries:  88%|████████▊ | 75190/85094 [00:01<00:00, 42553.56it/s][A
Processing valid queries:  94%|█████████▍| 79813/85094 [00:01<00:00, 43638.47it/s][A
Processing valid queries:  99%|█████████▉| 84181/85094 [00:01<00:00, 42531.25it/s][ALoading test-*.pkl:   0%|          | 0/3 [00:00<?, ?it/s]Processing valid queries: 100%|██████████| 85094/85094 [00:01<00:00, 44828.94it/s]
Loading test-*.pkl:  67%|██████▋   | 2/3 [00:04<00:02,  2.10s/it]Loading test-*.pkl: 100%|██████████| 3/3 [00:04<00:00,  1.36s/it]
Processing test queries:   0%|          | 0/87804 [00:00<?, ?it/s][ALoading test-*.pkl: 100%|██████████| 3/3 [00:04<00:00,  1.51s/it]

Processing test queries:   5%|▍         | 4238/87804 [00:00<00:01, 42372.46it/s][A
Processing test queries:  11%|█         | 9530/87804 [00:00<00:01, 48572.31it/s][A
Processing test queries:  17%|█▋        | 14914/87804 [00:00<00:01, 50974.03it/s][A
Processing test queries:  23%|██▎       | 20254/87804 [00:00<00:01, 51930.43it/s][A
Processing test queries:  29%|██▉       | 25448/87804 [00:00<00:01, 51816.39it/s][A
Processing test queries:  35%|███▍      | 30630/87804 [00:00<00:01, 50009.39it/s][A
Processing test queries:  41%|████      | 35643/87804 [00:00<00:01, 48900.30it/s][A
Processing test queries:  46%|████▌     | 40544/87804 [00:00<00:01, 46980.16it/s][A
Processing test queries:  52%|█████▏    | 45259/87804 [00:00<00:00, 44989.17it/s][A
Processing test queries:  57%|█████▋    | 49779/87804 [00:01<00:00, 44376.36it/s][A
Processing test queries:  62%|██████▏   | 54229/87804 [00:01<00:00, 44054.37it/s][A
Processing test queries:  67%|██████▋   | 58642/87804 [00:01<00:00, 43743.62it/s][A
Processing test queries:  72%|███████▏  | 63021/87804 [00:01<00:00, 42971.37it/s][A
Processing test queries:  77%|███████▋  | 67356/87804 [00:01<00:00, 43080.74it/s][A
Processing test queries:  82%|████████▏ | 71676/87804 [00:01<00:00, 43114.36it/s][A
Processing test queries:  87%|████████▋ | 75990/87804 [00:01<00:00, 42993.01it/s][A
Processing test queries:  91%|█████████▏| 80299/87804 [00:01<00:00, 43019.57it/s][A
Processing test queries:  96%|█████████▋| 84602/87804 [00:01<00:00, 42518.15it/s][AProcessing test queries: 100%|██████████| 87804/87804 [00:01<00:00, 44345.47it/s]
00:18:41   FB15k237LogicalQuery(
  #entity: 14505
  #relation: 474
  #triplet: 620158
  #query: 996183
)
00:18:41   #train: 823285, #valid: 85094, #test: 87804
00:18:41   Preprocess training set
00:18:42   {'batch_size': 48,
 'class': 'core.Engine',
 'gpus': [0],
 'gradient_interval': 1,
 'log_interval': 100,
 'logger': 'logging',
 'num_worker': 0,
 'optimizer': {'amsgrad': False,
               'betas': (0.9, 0.999),
               'capturable': False,
               'class': 'optim.Adam',
               'differentiable': False,
               'eps': 1e-08,
               'foreach': None,
               'fused': False,
               'lr': 0.005,
               'maximize': False,
               'weight_decay': 0},
 'scheduler': None,
 'task': {'adversarial_temperature': 0.2,
          'class': 'task.LogicalQuery',
          'criterion': 'bce',
          'metric': ('mrr',),
          'model': {'class': 'model.GNN-QE',
                    'dropout_ratio': 0.25,
                    'logic': 'product',
                    'model': {'activation': 'relu',
                              'aggregate_func': 'pna',
                              'class': 'model.NBFNet',
                              'concat_hidden': False,
                              'dependent': True,
                              'hidden_dims': [32, 32, 32, 32],
                              'input_dim': 32,
                              'layer_norm': True,
                              'message_func': 'distmult',
                              'num_relation': tensor(474),
                              'short_cut': True},
                    'num_mlp_layer': 2},
          'sample_weight': False},
 'test_set': {'class': 'dataset.Subset',
              'dataset': {'class': 'dataset.FB15k237LogicalQuery',
                          'path': '~/kg-datasets/',
                          'query_types': None,
                          'union_type': 'DNF',
                          'verbose': 1},
              'indices': range(908379, 996183)},
 'train_set': {'class': 'dataset.Subset',
               'dataset': {'class': 'dataset.FB15k237LogicalQuery',
                           'path': '~/kg-datasets/',
                           'query_types': None,
                           'union_type': 'DNF',
                           'verbose': 1},
               'indices': range(0, 823285)},
 'valid_set': {'class': 'dataset.Subset',
               'dataset': {'class': 'dataset.FB15k237LogicalQuery',
                           'path': '~/kg-datasets/',
                           'query_types': None,
                           'union_type': 'DNF',
                           'verbose': 1},
               'indices': range(823285, 908379)}}
00:18:42   >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
00:18:42   Epoch 0 begin
/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torch/nn/functional.py:1967: UserWarning: nn.functional.sigmoid is deprecated. Use torch.sigmoid instead.
  warnings.warn("nn.functional.sigmoid is deprecated. Use torch.sigmoid instead.")
/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torchdrug/data/graph.py:221: UserWarning: _maybe_num_relation() is used to determine the number of relations. This may underestimate the count if there are unseen relations.
  warnings.warn("_maybe_num_relation() is used to determine the number of relations. "
00:20:58   >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
00:20:58   binary cross entropy: 0.815339
Traceback (most recent call last):
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/script/run.py", line 59, in <module>
    train_and_validate(cfg, solver)
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/script/run.py", line 26, in train_and_validate
    solver.train(**kwargs)
  File "/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torchdrug/core/engine.py", line 161, in train
    loss, metric = model(batch)
  File "/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1190, in _call_impl
    return forward_call(*input, **kwargs)
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/gnnqe/task.py", line 56, in forward
    pred, target = self.predict_and_target(batch, all_loss, metric)
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/gnnqe/task.py", line 96, in predict_and_target
    pred = self.model(self.fact_graph, query, all_loss, metric)
  File "/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1190, in _call_impl
    return forward_call(*input, **kwargs)
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/gnnqe/model.py", line 101, in forward
    self.execute(graph, query, all_loss=all_loss, metric=metric)
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/gnnqe/model.py", line 94, in execute
    self.apply_projection(is_projection, graph, r_index, all_loss=all_loss, metric=metric)
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/gnnqe/model.py", line 168, in apply_projection
    t_prob = self.model(graph, h_prob, r_index, all_loss=all_loss, metric=metric)
  File "/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1190, in _call_impl
    return forward_call(*input, **kwargs)
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/gnnqe/model.py", line 220, in forward
    output = self.model(graph, input, all_loss=all_loss, metric=metric)
  File "/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1190, in _call_impl
    return forward_call(*input, **kwargs)
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/gnnqe/gnn.py", line 43, in forward
    hidden = layer(graph, layer_input)
  File "/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1190, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torchdrug/layers/conv.py", line 91, in forward
    update = self.message_and_aggregate(graph, input)
  File "/mnt/ialabnas/homes/tacucumides/GNN-QE/gnnqe/layer.py", line 154, in message_and_aggregate
    update = (features.unsqueeze(-1) * scales.unsqueeze(-2)).flatten(-2)
  File "/home/tacucumides/miniconda3/envs/gnn-qe/lib/python3.10/site-packages/torch/_tensor.py", line 1278, in __torch_function__
    ret = func(*args, **kwargs)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 574.00 MiB (GPU 0; 23.65 GiB total capacity; 21.91 GiB already allocated; 370.31 MiB free; 22.43 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
